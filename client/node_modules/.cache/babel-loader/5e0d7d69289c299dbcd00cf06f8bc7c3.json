{"ast":null,"code":"import { _ as _extends, a as _objectWithoutProperties, b as _slicedToArray, c as _objectSpread2, d as _defineProperty } from './index-ded791f3.js';\nimport React, { useRef, useEffect, useCallback, useImperativeHandle } from 'react';\nimport uploadcare from 'uploadcare-widget';\nimport { u as useCustomTabs, a as useDeepEffect } from './use-deep-effect-393663e2.js';\nimport isEqual from 'react-fast-compare';\nimport '@uploadcare/client-suspense';\n\nvar useCommitedRef = function useCommitedRef(value) {\n  var ref = useRef(value);\n  useEffect(function () {\n    ref.current = value;\n  }, [value]);\n  return ref;\n};\n\nvar useEventCallback = function useEventCallback(callback) {\n  var ref = useCommitedRef(callback);\n  return useCallback(function () {\n    return ref.current && ref.current.apply(ref, arguments);\n  }, [ref]);\n};\n\nvar useValidators = function useValidators(widget, validators) {\n  useEffect(function () {\n    if (validators != null) {\n      var instance = widget.current;\n      validators.forEach(function (validator) {\n        instance.validators.push(validator);\n      });\n      return function () {\n        instance.validators.length = 0;\n      };\n    }\n  }, [widget, validators]);\n};\n\nfunction useDeepMemo(factory, deps) {\n  var isValid = true;\n  var valueRef = useRef(); // initial hook call\n\n  if (!valueRef.current) {\n    valueRef.current = {\n      deps: deps,\n      result: factory()\n    }; // subsequent calls\n  } else {\n    isValid = !!(deps && valueRef.current.deps && isEqual(deps, valueRef.current.deps));\n  }\n\n  var cache = isValid ? valueRef.current : {\n    deps: deps,\n    result: factory()\n  }; // must update immediately so any sync renders here don't cause an infinite loop\n\n  valueRef.current = cache;\n  return cache.result;\n}\n\nfunction camelCaseToDash(str) {\n  return str.replace(/([a-zA-Z])(?=[A-Z])/g, '$1-').toLowerCase();\n}\n\nvar propsToAttr = function propsToAttr(props) {\n  return Object.entries(props).reduce(function (attr, _ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        key = _ref2[0],\n        value = _ref2[1];\n\n    return _objectSpread2(_objectSpread2({}, attr), {}, _defineProperty({}, \"data-\".concat(camelCaseToDash(key)), value));\n  }, {});\n};\n\nvar useWidget = function useWidget(_ref3, uploadcare) {\n  var id = _ref3.id,\n      name = _ref3.name,\n      value = _ref3.value,\n      onFileSelect = _ref3.onFileSelect,\n      onChange = _ref3.onChange,\n      onDialogOpen = _ref3.onDialogOpen,\n      onDialogClose = _ref3.onDialogClose,\n      onTabChange = _ref3.onTabChange,\n      apiRef = _ref3.apiRef,\n      customTabs = _ref3.customTabs,\n      validators = _ref3.validators,\n      tabsCss = _ref3.tabsCss,\n      locale = _ref3.locale,\n      localeTranslations = _ref3.localeTranslations,\n      localePluralize = _ref3.localePluralize,\n      previewUrlCallback = _ref3.previewUrlCallback,\n      options = _objectWithoutProperties(_ref3, [\"id\", \"name\", \"value\", \"onFileSelect\", \"onChange\", \"onDialogOpen\", \"onDialogClose\", \"onTabChange\", \"apiRef\", \"customTabs\", \"validators\", \"tabsCss\", \"locale\", \"localeTranslations\", \"localePluralize\", \"previewUrlCallback\"]);\n\n  var input = useRef(null);\n  var widget = useRef(null);\n  var fileSelectedCallback = useEventCallback(onFileSelect);\n  var changeCallback = useEventCallback(onChange);\n  var dialogOpenCallback = useEventCallback(onDialogOpen);\n  var dialogCloseCallback = useEventCallback(onDialogClose);\n  var tabChangeCallback = useEventCallback(onTabChange);\n  useCustomTabs(customTabs, uploadcare);\n  var attributes = useDeepMemo(function () {\n    return propsToAttr(options);\n  }, [options]);\n  useDeepEffect(function () {\n    if (locale) window.UPLOADCARE_LOCALE = locale;\n    if (localePluralize) window.UPLOADCARE_LOCALE_PLURALIZE = localePluralize;\n\n    if (localeTranslations) {\n      window.UPLOADCARE_LOCALE_TRANSLATIONS = localeTranslations;\n    }\n\n    if (previewUrlCallback) {\n      window.UPLOADCARE_PREVIEW_URL_CALLBACK = previewUrlCallback;\n    }\n\n    uploadcare.plugin(function (internal) {\n      internal.locale.rebuild({\n        locale: locale || null,\n        localeTranslations: localeTranslations || null,\n        localePluralize: localePluralize || null\n      });\n    });\n    return function () {\n      if (locale) delete window.UPLOADCARE_LOCALE;\n      if (localePluralize) delete window.UPLOADCARE_LOCALE_PLURALIZE;\n      if (localeTranslations) delete window.UPLOADCARE_LOCALE_TRANSLATIONS;\n      if (previewUrlCallback) delete window.UPLOADCARE_PREVIEW_URL_CALLBACK;\n    };\n  }, [locale, localeTranslations, localePluralize, previewUrlCallback]);\n  useEffect(function () {\n    widget.current = uploadcare.Widget(input.current);\n    var widgetElement = input.current.nextSibling;\n    return function () {\n      return widgetElement && widgetElement.parentNode.removeChild(widgetElement);\n    };\n  }, [uploadcare, attributes]);\n  useValidators(widget, validators);\n  useEffect(function () {\n    widget.current.onUploadComplete.add(changeCallback);\n    widget.current.onChange.add(fileSelectedCallback);\n    return function () {\n      widget.current.onUploadComplete.remove(changeCallback);\n      widget.current.onChange.remove(fileSelectedCallback);\n    };\n  }, [changeCallback, fileSelectedCallback, uploadcare, attributes]);\n  useEffect(function () {\n    var dialog;\n\n    var saveDialog = function saveDialog(ref) {\n      dialog = ref;\n      dialog.done(dialogCloseCallback).fail(dialogCloseCallback).progress(tabChangeCallback);\n      dialogOpenCallback(ref);\n    };\n\n    widget.current.onDialogOpen.add(saveDialog);\n    return function () {\n      widget.current.onDialogOpen.remove(saveDialog);\n      dialog && dialog.reject();\n    };\n  }, [attributes, dialogCloseCallback, dialogOpenCallback, tabChangeCallback]);\n  useEffect(function () {\n    var files = [];\n\n    var saveFiles = function saveFiles(file) {\n      if (file) {\n        files = file.files ? file.files() : [file];\n      } else {\n        files = [];\n      }\n    };\n\n    widget.current.onChange.add(saveFiles);\n    return function () {\n      files.forEach(function (file) {\n        return file.cancel();\n      });\n      widget.current.onChange.remove(saveFiles);\n    };\n  }, [attributes]);\n  useEffect(function () {\n    widget.current.value(value);\n  }, [value]);\n  useEffect(function () {\n    if (uploadcare && tabsCss && typeof tabsCss === 'string') {\n      if (tabsCss.indexOf('https://') === 0) {\n        uploadcare.tabsCss.addUrl(tabsCss);\n      } else {\n        uploadcare.tabsCss.addStyle(tabsCss);\n      }\n    }\n  }, [uploadcare, tabsCss]);\n  useImperativeHandle(apiRef, function () {\n    return {\n      openDialog: function openDialog() {\n        return widget.current.openDialog();\n      },\n      reloadInfo: function reloadInfo() {\n        return widget.current.reloadInfo();\n      },\n      getInput: function getInput() {\n        return widget.current.inputElement;\n      }\n    };\n  }, []);\n  return useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"input\", _extends({\n      type: \"hidden\",\n      ref: input,\n      id: id,\n      name: name\n    }, attributes));\n  }, [attributes, id, name]);\n};\n\nvar Uploader = function Uploader(props) {\n  var Input = useWidget(props, uploadcare);\n  return /*#__PURE__*/React.createElement(Input, null);\n};\n\nexport default Uploader;","map":{"version":3,"sources":["D:/Work/websheets/node_modules/@uploadcare/react-widget/dist/esm/uploader-5199635b.js"],"names":["_","_extends","a","_objectWithoutProperties","b","_slicedToArray","c","_objectSpread2","d","_defineProperty","React","useRef","useEffect","useCallback","useImperativeHandle","uploadcare","u","useCustomTabs","useDeepEffect","isEqual","useCommitedRef","value","ref","current","useEventCallback","callback","apply","arguments","useValidators","widget","validators","instance","forEach","validator","push","length","useDeepMemo","factory","deps","isValid","valueRef","result","cache","camelCaseToDash","str","replace","toLowerCase","propsToAttr","props","Object","entries","reduce","attr","_ref","_ref2","key","concat","useWidget","_ref3","id","name","onFileSelect","onChange","onDialogOpen","onDialogClose","onTabChange","apiRef","customTabs","tabsCss","locale","localeTranslations","localePluralize","previewUrlCallback","options","input","fileSelectedCallback","changeCallback","dialogOpenCallback","dialogCloseCallback","tabChangeCallback","attributes","window","UPLOADCARE_LOCALE","UPLOADCARE_LOCALE_PLURALIZE","UPLOADCARE_LOCALE_TRANSLATIONS","UPLOADCARE_PREVIEW_URL_CALLBACK","plugin","internal","rebuild","Widget","widgetElement","nextSibling","parentNode","removeChild","onUploadComplete","add","remove","dialog","saveDialog","done","fail","progress","reject","files","saveFiles","file","cancel","indexOf","addUrl","addStyle","openDialog","reloadInfo","getInput","inputElement","createElement","type","Uploader","Input"],"mappings":"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","sourcesContent":["import { _ as _extends, a as _objectWithoutProperties, b as _slicedToArray, c as _objectSpread2, d as _defineProperty } from './index-ded791f3.js';\nimport React, { useRef, useEffect, useCallback, useImperativeHandle } from 'react';\nimport uploadcare from 'uploadcare-widget';\nimport { u as useCustomTabs, a as useDeepEffect } from './use-deep-effect-393663e2.js';\nimport isEqual from 'react-fast-compare';\nimport '@uploadcare/client-suspense';\n\nvar useCommitedRef = function useCommitedRef(value) {\n  var ref = useRef(value);\n  useEffect(function () {\n    ref.current = value;\n  }, [value]);\n  return ref;\n};\n\nvar useEventCallback = function useEventCallback(callback) {\n  var ref = useCommitedRef(callback);\n  return useCallback(function () {\n    return ref.current && ref.current.apply(ref, arguments);\n  }, [ref]);\n};\n\nvar useValidators = function useValidators(widget, validators) {\n  useEffect(function () {\n    if (validators != null) {\n      var instance = widget.current;\n      validators.forEach(function (validator) {\n        instance.validators.push(validator);\n      });\n      return function () {\n        instance.validators.length = 0;\n      };\n    }\n  }, [widget, validators]);\n};\n\nfunction useDeepMemo(factory, deps) {\n  var isValid = true;\n  var valueRef = useRef(); // initial hook call\n\n  if (!valueRef.current) {\n    valueRef.current = {\n      deps: deps,\n      result: factory()\n    }; // subsequent calls\n  } else {\n    isValid = !!(deps && valueRef.current.deps && isEqual(deps, valueRef.current.deps));\n  }\n\n  var cache = isValid ? valueRef.current : {\n    deps: deps,\n    result: factory()\n  }; // must update immediately so any sync renders here don't cause an infinite loop\n\n  valueRef.current = cache;\n  return cache.result;\n}\n\nfunction camelCaseToDash(str) {\n  return str.replace(/([a-zA-Z])(?=[A-Z])/g, '$1-').toLowerCase();\n}\n\nvar propsToAttr = function propsToAttr(props) {\n  return Object.entries(props).reduce(function (attr, _ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        key = _ref2[0],\n        value = _ref2[1];\n\n    return _objectSpread2(_objectSpread2({}, attr), {}, _defineProperty({}, \"data-\".concat(camelCaseToDash(key)), value));\n  }, {});\n};\n\nvar useWidget = function useWidget(_ref3, uploadcare) {\n  var id = _ref3.id,\n      name = _ref3.name,\n      value = _ref3.value,\n      onFileSelect = _ref3.onFileSelect,\n      onChange = _ref3.onChange,\n      onDialogOpen = _ref3.onDialogOpen,\n      onDialogClose = _ref3.onDialogClose,\n      onTabChange = _ref3.onTabChange,\n      apiRef = _ref3.apiRef,\n      customTabs = _ref3.customTabs,\n      validators = _ref3.validators,\n      tabsCss = _ref3.tabsCss,\n      locale = _ref3.locale,\n      localeTranslations = _ref3.localeTranslations,\n      localePluralize = _ref3.localePluralize,\n      previewUrlCallback = _ref3.previewUrlCallback,\n      options = _objectWithoutProperties(_ref3, [\"id\", \"name\", \"value\", \"onFileSelect\", \"onChange\", \"onDialogOpen\", \"onDialogClose\", \"onTabChange\", \"apiRef\", \"customTabs\", \"validators\", \"tabsCss\", \"locale\", \"localeTranslations\", \"localePluralize\", \"previewUrlCallback\"]);\n\n  var input = useRef(null);\n  var widget = useRef(null);\n  var fileSelectedCallback = useEventCallback(onFileSelect);\n  var changeCallback = useEventCallback(onChange);\n  var dialogOpenCallback = useEventCallback(onDialogOpen);\n  var dialogCloseCallback = useEventCallback(onDialogClose);\n  var tabChangeCallback = useEventCallback(onTabChange);\n  useCustomTabs(customTabs, uploadcare);\n  var attributes = useDeepMemo(function () {\n    return propsToAttr(options);\n  }, [options]);\n  useDeepEffect(function () {\n    if (locale) window.UPLOADCARE_LOCALE = locale;\n    if (localePluralize) window.UPLOADCARE_LOCALE_PLURALIZE = localePluralize;\n\n    if (localeTranslations) {\n      window.UPLOADCARE_LOCALE_TRANSLATIONS = localeTranslations;\n    }\n\n    if (previewUrlCallback) {\n      window.UPLOADCARE_PREVIEW_URL_CALLBACK = previewUrlCallback;\n    }\n\n    uploadcare.plugin(function (internal) {\n      internal.locale.rebuild({\n        locale: locale || null,\n        localeTranslations: localeTranslations || null,\n        localePluralize: localePluralize || null\n      });\n    });\n    return function () {\n      if (locale) delete window.UPLOADCARE_LOCALE;\n      if (localePluralize) delete window.UPLOADCARE_LOCALE_PLURALIZE;\n      if (localeTranslations) delete window.UPLOADCARE_LOCALE_TRANSLATIONS;\n      if (previewUrlCallback) delete window.UPLOADCARE_PREVIEW_URL_CALLBACK;\n    };\n  }, [locale, localeTranslations, localePluralize, previewUrlCallback]);\n  useEffect(function () {\n    widget.current = uploadcare.Widget(input.current);\n    var widgetElement = input.current.nextSibling;\n    return function () {\n      return widgetElement && widgetElement.parentNode.removeChild(widgetElement);\n    };\n  }, [uploadcare, attributes]);\n  useValidators(widget, validators);\n  useEffect(function () {\n    widget.current.onUploadComplete.add(changeCallback);\n    widget.current.onChange.add(fileSelectedCallback);\n    return function () {\n      widget.current.onUploadComplete.remove(changeCallback);\n      widget.current.onChange.remove(fileSelectedCallback);\n    };\n  }, [changeCallback, fileSelectedCallback, uploadcare, attributes]);\n  useEffect(function () {\n    var dialog;\n\n    var saveDialog = function saveDialog(ref) {\n      dialog = ref;\n      dialog.done(dialogCloseCallback).fail(dialogCloseCallback).progress(tabChangeCallback);\n      dialogOpenCallback(ref);\n    };\n\n    widget.current.onDialogOpen.add(saveDialog);\n    return function () {\n      widget.current.onDialogOpen.remove(saveDialog);\n      dialog && dialog.reject();\n    };\n  }, [attributes, dialogCloseCallback, dialogOpenCallback, tabChangeCallback]);\n  useEffect(function () {\n    var files = [];\n\n    var saveFiles = function saveFiles(file) {\n      if (file) {\n        files = file.files ? file.files() : [file];\n      } else {\n        files = [];\n      }\n    };\n\n    widget.current.onChange.add(saveFiles);\n    return function () {\n      files.forEach(function (file) {\n        return file.cancel();\n      });\n      widget.current.onChange.remove(saveFiles);\n    };\n  }, [attributes]);\n  useEffect(function () {\n    widget.current.value(value);\n  }, [value]);\n  useEffect(function () {\n    if (uploadcare && tabsCss && typeof tabsCss === 'string') {\n      if (tabsCss.indexOf('https://') === 0) {\n        uploadcare.tabsCss.addUrl(tabsCss);\n      } else {\n        uploadcare.tabsCss.addStyle(tabsCss);\n      }\n    }\n  }, [uploadcare, tabsCss]);\n  useImperativeHandle(apiRef, function () {\n    return {\n      openDialog: function openDialog() {\n        return widget.current.openDialog();\n      },\n      reloadInfo: function reloadInfo() {\n        return widget.current.reloadInfo();\n      },\n      getInput: function getInput() {\n        return widget.current.inputElement;\n      }\n    };\n  }, []);\n  return useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"input\", _extends({\n      type: \"hidden\",\n      ref: input,\n      id: id,\n      name: name\n    }, attributes));\n  }, [attributes, id, name]);\n};\n\nvar Uploader = function Uploader(props) {\n  var Input = useWidget(props, uploadcare);\n  return /*#__PURE__*/React.createElement(Input, null);\n};\n\nexport default Uploader;\n"]},"metadata":{},"sourceType":"module"}