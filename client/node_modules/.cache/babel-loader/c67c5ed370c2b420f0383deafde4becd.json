{"ast":null,"code":"import _objectSpread from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _asyncToGenerator from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _regeneratorRuntime from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import Input from\"./../../Custom/FormInput/FormInput\";import{FormProvider}from\"react-hook-form\";import{useForm}from\"react-hook-form\";import axios from\"axios\";import{useDispatch}from\"react-redux\";import{login}from\"../../../redux/app/appActions\";import css from\"./RegistrationForm.module.css\";import{useNavigate}from\"react-router-dom\";import{domain}from\"../../../config\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EMAIL_PATTERN=/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;var RegistrationForm=function RegistrationForm(){var formMethods=useForm();var navigate=useNavigate();var dispatch=useDispatch();var setError=formMethods.setError,handleSubmit=formMethods.handleSubmit;var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData){var _yield$axios$post,data,_error$response,myError;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(formData.password===formData.repeatPassword){_context.next=3;break;}setError(\"password\",{type:\"notSame\",message:\"Passwords are not the same\"});return _context.abrupt(\"return\");case 3:_context.prev=3;_context.next=6;return axios.post(\"\".concat(domain,\"/auth/registration\"),_objectSpread({},formData));case 6:_yield$axios$post=_context.sent;data=_yield$axios$post.data;if(data.response===\"success\"){dispatch(login(data.userId));navigate(\"/user\");}if(data.response===\"fail\")console.log(\"Database error\");_context.next=21;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](3);myError=_context.t0===null||_context.t0===void 0?void 0:(_error$response=_context.t0.response)===null||_error$response===void 0?void 0:_error$response.data;_context.t1=myError===null||myError===void 0?void 0:myError.cause;_context.next=_context.t1===\"isExist\"?18:20;break;case 18:setError(myError.field,{type:\"isExist\",message:\"\".concat(myError.label,\" \\u0443\\u0436\\u0435 \\u0441\\u0443\\u0449\\u0435\\u0441\\u0442\\u0432\\u0443\\u0435\\u0442\")});return _context.abrupt(\"break\",21);case 20:console.log(\"Неизвестная ошибка\",_context.t0);case 21:case\"end\":return _context.stop();}}},_callee,null,[[3,12]]);}));return function onSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(FormProvider,_objectSpread(_objectSpread({},formMethods),{},{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{className:css.form,children:[/*#__PURE__*/_jsx(Input,{name:\"firstName\",label:\"\\u0418\\u043C\\u044F\",validator:{minLength:2,maxLength:25}}),/*#__PURE__*/_jsx(Input,{name:\"lastName\",label:\"\\u0424\\u0430\\u043C\\u0438\\u043B\\u0438\\u044F\",validator:{minLength:2,maxLength:25}}),/*#__PURE__*/_jsx(Input,{name:\"email\",label:\"Email\",validator:{pattern:EMAIL_PATTERN}}),/*#__PURE__*/_jsx(Input,{name:\"username\",label:\"\\u041D\\u0438\\u043A\\u043D\\u0435\\u0439\\u043C\",validator:{minLength:2,maxLength:25}}),/*#__PURE__*/_jsx(Input,{name:\"password\",type:\"password\",label:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\",validator:{minLength:6,maxLength:50}}),/*#__PURE__*/_jsx(Input,{name:\"repeatPassword\",type:\"password\",label:\"\\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u0435 \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\",validator:{minLength:6,maxLength:50}})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:css.submit,children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]})}));};export default RegistrationForm;","map":{"version":3,"sources":["D:/Work/Projects/web_sheet_node_server/client/src/components/Authorization/RegistrationForm/RegistrationForm.jsx"],"names":["Input","FormProvider","useForm","axios","useDispatch","login","css","useNavigate","domain","EMAIL_PATTERN","RegistrationForm","formMethods","navigate","dispatch","setError","handleSubmit","onSubmit","formData","password","repeatPassword","type","message","post","data","response","userId","console","log","myError","cause","field","label","form","minLength","maxLength","pattern","submit"],"mappings":"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","sourcesContent":["import Input from \"./../../Custom/FormInput/FormInput\";\r\nimport { FormProvider } from \"react-hook-form\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport axios from \"axios\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { login } from \"../../../redux/app/appActions\";\r\nimport css from \"./RegistrationForm.module.css\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { domain } from \"../../../config\";\r\n\r\nconst EMAIL_PATTERN =\r\n  /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\nconst RegistrationForm = () => {\r\n  const formMethods = useForm();\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n\r\n  const { setError, handleSubmit } = formMethods;\r\n\r\n  const onSubmit = async (formData) => {\r\n    if (!(formData.password === formData.repeatPassword)) {\r\n      setError(\"password\", {\r\n        type: \"notSame\",\r\n        message: \"Passwords are not the same\",\r\n      });\r\n      return;\r\n    }\r\n    try {\r\n      const { data } = await axios.post(`${domain}/auth/registration`, {\r\n        ...formData,\r\n      });\r\n\r\n      if (data.response === \"success\") {\r\n        dispatch(login(data.userId));\r\n        navigate(\"/user\");\r\n      }\r\n      if (data.response === \"fail\") console.log(\"Database error\");\r\n    } catch (error) {\r\n      const myError = error?.response?.data;\r\n\r\n      switch (myError?.cause) {\r\n        case \"isExist\":\r\n          setError(myError.field, {\r\n            type: \"isExist\",\r\n            message: `${myError.label} уже существует`,\r\n          });\r\n          break;\r\n\r\n        default:\r\n          console.log(\"Неизвестная ошибка\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <FormProvider {...formMethods}>\r\n      <form onSubmit={handleSubmit(onSubmit)}>\r\n        <div className={css.form}>\r\n          <Input\r\n            name=\"firstName\"\r\n            label=\"Имя\"\r\n            validator={{ minLength: 2, maxLength: 25 }}\r\n          />\r\n          <Input\r\n            name=\"lastName\"\r\n            label=\"Фамилия\"\r\n            validator={{ minLength: 2, maxLength: 25 }}\r\n          />\r\n          <Input\r\n            name=\"email\"\r\n            label=\"Email\"\r\n            validator={{ pattern: EMAIL_PATTERN }}\r\n          />\r\n          <Input\r\n            name=\"username\"\r\n            label=\"Никнейм\"\r\n            validator={{ minLength: 2, maxLength: 25 }}\r\n          />\r\n          <Input\r\n            name=\"password\"\r\n            type=\"password\"\r\n            label=\"Пароль\"\r\n            validator={{ minLength: 6, maxLength: 50 }}\r\n          />\r\n          <Input\r\n            name=\"repeatPassword\"\r\n            type=\"password\"\r\n            label=\"Повторите пароль\"\r\n            validator={{ minLength: 6, maxLength: 50 }}\r\n          />\r\n        </div>\r\n\r\n        <button type=\"submit\" className={css.submit}>\r\n          Отправить\r\n        </button>\r\n      </form>\r\n    </FormProvider>\r\n  );\r\n};\r\n\r\nexport default RegistrationForm;\r\n"]},"metadata":{},"sourceType":"module"}