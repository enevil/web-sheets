{"ast":null,"code":"var _jsxFileName = \"D:\\\\Work\\\\websheets\\\\src\\\\components\\\\Recipes\\\\AddRecipeForm\\\\AddRecipeForm.jsx\",\n    _s = $RefreshSig$();\n\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { useState } from \"react\";\nimport css from \"./AddRecipeForm.module.css\";\nimport FormBody from \"./FormBody/FormBody\";\nimport GoBack from \"../../Custom/GoBack/GoBack\";\nimport axios from \"axios\";\nimport { useNavigate } from \"react-router-dom\";\nimport FormHeader from \"./FormHeader/FormHeader\";\nimport { useSelector } from \"react-redux\";\nimport { useEffect } from \"react\";\nimport { domain } from \"../../../config\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst AddRecipeForm = _ref => {\n  _s();\n\n  let {\n    defaultProps\n  } = _ref;\n  const {\n    userId\n  } = useSelector(state => state.app);\n  const formMethods = useForm({\n    defaultValues: defaultProps || {\n      products: [{\n        ingredient: \"\",\n        weightOf: \"\"\n      }]\n    }\n  });\n  const {\n    handleSubmit,\n    reset\n  } = formMethods;\n  const [imageError, setImageError] = useState(\"\");\n  const [img, setImg] = useState();\n  const navigate = useNavigate();\n\n  const goBack = () => {\n    navigate(-1);\n  }; // refresh defaultValues\n\n\n  useEffect(() => {\n    reset(defaultProps);\n  }, [defaultProps, reset]);\n\n  const onSubmit = async formData => {\n    try {\n      const {\n        description,\n        name,\n        type,\n        products\n      } = formData;\n      const prepFormData = {\n        description,\n        name,\n        author: userId,\n        type,\n        products,\n        oldPath: defaultProps === null || defaultProps === void 0 ? void 0 : defaultProps.pathImg,\n        id: defaultProps === null || defaultProps === void 0 ? void 0 : defaultProps._id\n      };\n      const endpoint = defaultProps ? \"edit\" : \"add\";\n      const method = defaultProps ? \"put\" : \"post\";\n      const newFormData = new FormData(); // ORDER VERY IMPORTANT\n\n      newFormData.append(\"formData\", JSON.stringify(prepFormData));\n      newFormData.append(\"img\", img);\n      const response = await axios({\n        method,\n        url: `${domain}/recipe/${endpoint}`,\n        data: newFormData,\n        params: {\n          hasImg: !!img ? \"true\" : \"\"\n        },\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      });\n      console.log(response);\n      if (response.data.success) goBack();\n    } catch (error) {\n      var _error$response, _error$response$data, _error$response$data$;\n\n      const errorCode = error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : (_error$response$data$ = _error$response$data.e) === null || _error$response$data$ === void 0 ? void 0 : _error$response$data$.code;\n\n      if (errorCode) {\n        setImageError(errorCode);\n      } else {\n        setImageError(\"UNDEFIEND_IMAGE_ERROR\");\n      }\n\n      console.log(error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"defaultContainer\",\n    children: [/*#__PURE__*/_jsxDEV(GoBack, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(FormProvider, { ...formMethods,\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(onSubmit),\n        children: [/*#__PURE__*/_jsxDEV(FormHeader, {\n          img: img,\n          setImg: setImg,\n          imageError: imageError,\n          updatePreview: defaultProps === null || defaultProps === void 0 ? void 0 : defaultProps.pathImg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormBody, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: css.submit,\n          children: \"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 74,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AddRecipeForm, \"2DYqIG71f9BBrkWcSfGkIamBaRQ=\", false, function () {\n  return [useSelector, useForm, useNavigate];\n});\n\n_c = AddRecipeForm;\nexport default AddRecipeForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddRecipeForm\");","map":{"version":3,"sources":["D:/Work/websheets/src/components/Recipes/AddRecipeForm/AddRecipeForm.jsx"],"names":["FormProvider","useForm","useState","css","FormBody","GoBack","axios","useNavigate","FormHeader","useSelector","useEffect","domain","AddRecipeForm","defaultProps","userId","state","app","formMethods","defaultValues","products","ingredient","weightOf","handleSubmit","reset","imageError","setImageError","img","setImg","navigate","goBack","onSubmit","formData","description","name","type","prepFormData","author","oldPath","pathImg","id","_id","endpoint","method","newFormData","FormData","append","JSON","stringify","response","url","data","params","hasImg","headers","console","log","success","error","errorCode","e","code","submit"],"mappings":"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","sourcesContent":["import { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useState } from \"react\";\r\n\r\nimport css from \"./AddRecipeForm.module.css\";\r\nimport FormBody from \"./FormBody/FormBody\";\r\nimport GoBack from \"../../Custom/GoBack/GoBack\";\r\nimport axios from \"axios\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport FormHeader from \"./FormHeader/FormHeader\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useEffect } from \"react\";\r\nimport { domain } from \"../../../config\";\r\n\r\nconst AddRecipeForm = ({ defaultProps }) => {\r\n  const { userId } = useSelector((state) => state.app);\r\n  const formMethods = useForm({\r\n    defaultValues: defaultProps || {\r\n      products: [{ ingredient: \"\", weightOf: \"\" }],\r\n    },\r\n  });\r\n  const { handleSubmit, reset } = formMethods;\r\n  const [imageError, setImageError] = useState(\"\");\r\n\r\n  const [img, setImg] = useState();\r\n  const navigate = useNavigate();\r\n  const goBack = () => {\r\n    navigate(-1);\r\n  };\r\n\r\n  // refresh defaultValues\r\n  useEffect(() => {\r\n    reset(defaultProps);\r\n  }, [defaultProps, reset]);\r\n\r\n  const onSubmit = async (formData) => {\r\n    try {\r\n      const { description, name, type, products } = formData;\r\n      const prepFormData = {\r\n        description,\r\n        name,\r\n        author: userId,\r\n        type,\r\n        products,\r\n        oldPath: defaultProps?.pathImg,\r\n        id: defaultProps?._id,\r\n      };\r\n      const endpoint = defaultProps ? \"edit\" : \"add\";\r\n      const method = defaultProps ? \"put\" : \"post\";\r\n      const newFormData = new FormData();\r\n      // ORDER VERY IMPORTANT\r\n      newFormData.append(\"formData\", JSON.stringify(prepFormData));\r\n      newFormData.append(\"img\", img);\r\n      const response = await axios({\r\n        method,\r\n        url: `${domain}/recipe/${endpoint}`,\r\n        data: newFormData,\r\n        params: { hasImg: !!img ? \"true\" : \"\" },\r\n        headers: { \"Content-Type\": \"multipart/form-data\" },\r\n      });\r\n      console.log(response);\r\n      if (response.data.success) goBack();\r\n    } catch (error) {\r\n      const errorCode = error?.response?.data?.e?.code;\r\n      if (errorCode) {\r\n        setImageError(errorCode);\r\n      } else {\r\n        setImageError(\"UNDEFIEND_IMAGE_ERROR\");\r\n      }\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"defaultContainer\">\r\n      <GoBack />\r\n      <FormProvider {...formMethods}>\r\n        <form onSubmit={handleSubmit(onSubmit)}>\r\n          <FormHeader\r\n            img={img}\r\n            setImg={setImg}\r\n            imageError={imageError}\r\n            updatePreview={defaultProps?.pathImg}\r\n          />\r\n          <FormBody />\r\n          <button type=\"submit\" className={css.submit}>\r\n            Подтвердить\r\n          </button>\r\n        </form>\r\n      </FormProvider>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddRecipeForm;\r\n"]},"metadata":{},"sourceType":"module"}