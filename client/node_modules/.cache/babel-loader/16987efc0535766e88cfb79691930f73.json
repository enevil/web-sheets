{"ast":null,"code":"import _slicedToArray from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import{withAuth}from\"../hoc/withAuth\";import{Chart as ChartJS,CategoryScale,LinearScale,BarElement,Title,Tooltip,Legend}from\"chart.js\";import css from\"./Statistic.module.css\";import{Bar}from\"react-chartjs-2\";import{useCallback,useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{loadMainDate}from\"../../redux/calendar/calendarActions\";import Results from\"./Results/Results\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,BarElement,Title,Tooltip,Legend);var ruMonthes=[\"январь\",\"февраль\",\"март\",\"апрель\",\"май\",\"июнь\",\"июль\",\"август\",\"сентябрь\",\"октябрь\",\"ноябрь\",\"декабрь\"];var options={responsive:true,plugins:{legend:{display:false}}};function sameDay(d1,d2){return d1.getFullYear()===d2.getFullYear()&&d1.getDate()===d2.getDate()&&d1.getMonth()===d2.getMonth();}function getDaysInMonth(date){var firstDay=new Date(date.getFullYear(),date.getMonth(),1);var lastDay=new Date(date.getFullYear(),date.getMonth()+1,0);var startDay=firstDay;var days=[];while(!sameDay(lastDay,startDay)){days.push(new Date(startDay));startDay.setDate(startDay.getDate()+1);}days.push(new Date(startDay));return days;}var Statistic=function Statistic(){var _useSelector=useSelector(function(state){return state.calendar;}),workShifts=_useSelector.workShifts;var _useSelector2=useSelector(function(state){return state.user;}),personId=_useSelector2.personId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),visDate=_useState2[0],setVisDate=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),datesInMonth=_useState4[0],setDatesInMonth=_useState4[1];var _useState5=useState(new Date(new Date().setDate(1))),_useState6=_slicedToArray(_useState5,2),currentDate=_useState6[0],setCurrentDate=_useState6[1];var dispatch=useDispatch();useEffect(function(){dispatch(loadMainDate(personId));},[personId,dispatch]);useEffect(function(){var datesInMonth=getDaysInMonth(currentDate);var wsInThisMonth=workShifts.filter(function(item){var lastDateInMonth=new Date(currentDate).setDate(30);if(item.date<=lastDateInMonth&&item.date>=currentDate)return true;return false;});if(wsInThisMonth.length){var wsIndex=0;var vis=datesInMonth.map(function(date){if(wsIndex>=wsInThisMonth.length)return 0;if(sameDay(date,wsInThisMonth[wsIndex].date)){var workHours=wsInThisMonth[wsIndex].shiftTime.split(\"-\");var workTime=+workHours[1]-+workHours[0];wsIndex++;if(isNaN(workTime))return 0;return workTime;}return 0;});setVisDate(vis);}else if(wsInThisMonth.length===0){var _vis=datesInMonth.map(function(){return 0;});setVisDate(_vis);}setDatesInMonth(datesInMonth);},[workShifts,currentDate]);var monthSwitch=useCallback(function(step){var newDate=new Date(currentDate);newDate.setMonth(newDate.getMonth()+step);setCurrentDate(newDate);},[currentDate]);var data={labels:datesInMonth.map(function(_,i){return i+1;}),datasets:[{label:\"Отработанные часы\",data:visDate,backgroundColor:\"rgba(201, 119, 119, 0.8)\"}]};return/*#__PURE__*/_jsxs(\"div\",{className:css.container,children:[/*#__PURE__*/_jsx(\"div\",{className:css.topInfo,children:/*#__PURE__*/_jsx(\"p\",{children:\"\\u041A\\u043E\\u043B-\\u0432\\u043E \\u043E\\u0442\\u0440\\u0430\\u0431\\u043E\\u0442\\u0430\\u043D\\u043D\\u044B\\u0445 \\u0447\\u0430\\u0441\\u043E\\u0432\"})}),/*#__PURE__*/_jsx(Bar,{options:options,data:data}),/*#__PURE__*/_jsxs(\"div\",{className:css.month,children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return monthSwitch(-1);},className:css.arrow,children:\"<\"}),/*#__PURE__*/_jsxs(\"p\",{className:css.monthText,children:[ruMonthes[currentDate.getMonth()],\" \",currentDate.getFullYear()]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return monthSwitch(1);},className:css.arrow,children:\">\"}),/*#__PURE__*/_jsx(Results,{visDate:visDate})]})]});};export default withAuth(Statistic);","map":{"version":3,"sources":["D:/Work/Projects/web_sheet_node_server/client/src/components/Statistic/Statistic.jsx"],"names":["withAuth","Chart","ChartJS","CategoryScale","LinearScale","BarElement","Title","Tooltip","Legend","css","Bar","useCallback","useEffect","useState","useDispatch","useSelector","loadMainDate","Results","register","ruMonthes","options","responsive","plugins","legend","display","sameDay","d1","d2","getFullYear","getDate","getMonth","getDaysInMonth","date","firstDay","Date","lastDay","startDay","days","push","setDate","Statistic","state","calendar","workShifts","user","personId","visDate","setVisDate","datesInMonth","setDatesInMonth","currentDate","setCurrentDate","dispatch","wsInThisMonth","filter","item","lastDateInMonth","length","wsIndex","vis","map","workHours","shiftTime","split","workTime","isNaN","monthSwitch","step","newDate","setMonth","data","labels","_","i","datasets","label","backgroundColor","container","topInfo","month","arrow","monthText"],"mappings":"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","sourcesContent":["import { withAuth } from \"../hoc/withAuth\";\r\nimport {\r\n  Chart as ChartJS,\r\n  CategoryScale,\r\n  LinearScale,\r\n  BarElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n} from \"chart.js\";\r\nimport css from \"./Statistic.module.css\";\r\nimport { Bar } from \"react-chartjs-2\";\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { loadMainDate } from \"../../redux/calendar/calendarActions\";\r\nimport Results from \"./Results/Results\";\r\n\r\nChartJS.register(\r\n  CategoryScale,\r\n  LinearScale,\r\n  BarElement,\r\n  Title,\r\n  Tooltip,\r\n  Legend\r\n);\r\n\r\nconst ruMonthes = [\r\n  \"январь\",\r\n  \"февраль\",\r\n  \"март\",\r\n  \"апрель\",\r\n  \"май\",\r\n  \"июнь\",\r\n  \"июль\",\r\n  \"август\",\r\n  \"сентябрь\",\r\n  \"октябрь\",\r\n  \"ноябрь\",\r\n  \"декабрь\",\r\n];\r\n\r\nconst options = {\r\n  responsive: true,\r\n  plugins: {\r\n    legend: {\r\n      display: false,\r\n    },\r\n  },\r\n};\r\n\r\nfunction sameDay(d1, d2) {\r\n  return (\r\n    d1.getFullYear() === d2.getFullYear() &&\r\n    d1.getDate() === d2.getDate() &&\r\n    d1.getMonth() === d2.getMonth()\r\n  );\r\n}\r\n\r\nfunction getDaysInMonth(date) {\r\n  let firstDay = new Date(date.getFullYear(), date.getMonth(), 1);\r\n  let lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);\r\n\r\n  let startDay = firstDay;\r\n  let days = [];\r\n  while (!sameDay(lastDay, startDay)) {\r\n    days.push(new Date(startDay));\r\n    startDay.setDate(startDay.getDate() + 1);\r\n  }\r\n  days.push(new Date(startDay));\r\n  return days;\r\n}\r\n\r\nconst Statistic = () => {\r\n  const { workShifts } = useSelector((state) => state.calendar);\r\n  const { personId } = useSelector((state) => state.user);\r\n  const [visDate, setVisDate] = useState([]);\r\n  const [datesInMonth, setDatesInMonth] = useState([]);\r\n  const [currentDate, setCurrentDate] = useState(\r\n    new Date(new Date().setDate(1))\r\n  );\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(loadMainDate(personId));\r\n  }, [personId, dispatch]);\r\n\r\n  useEffect(() => {\r\n    const datesInMonth = getDaysInMonth(currentDate);\r\n    const wsInThisMonth = workShifts.filter((item) => {\r\n      const lastDateInMonth = new Date(currentDate).setDate(30);\r\n      if (item.date <= lastDateInMonth && item.date >= currentDate) return true;\r\n      return false;\r\n    });\r\n\r\n    if (wsInThisMonth.length) {\r\n      let wsIndex = 0;\r\n      const vis = datesInMonth.map((date) => {\r\n        if (wsIndex >= wsInThisMonth.length) return 0;\r\n        if (sameDay(date, wsInThisMonth[wsIndex].date)) {\r\n          const workHours = wsInThisMonth[wsIndex].shiftTime.split(\"-\");\r\n          const workTime = +workHours[1] - +workHours[0];\r\n          wsIndex++;\r\n          if (isNaN(workTime)) return 0;\r\n          return workTime;\r\n        }\r\n        return 0;\r\n      });\r\n\r\n      setVisDate(vis);\r\n    } else if (wsInThisMonth.length === 0) {\r\n      const vis = datesInMonth.map(() => 0);\r\n      setVisDate(vis);\r\n    }\r\n    setDatesInMonth(datesInMonth);\r\n  }, [workShifts, currentDate]);\r\n\r\n  const monthSwitch = useCallback(\r\n    (step) => {\r\n      const newDate = new Date(currentDate);\r\n      newDate.setMonth(newDate.getMonth() + step);\r\n      setCurrentDate(newDate);\r\n    },\r\n    [currentDate]\r\n  );\r\n\r\n  const data = {\r\n    labels: datesInMonth.map((_, i) => i + 1),\r\n    datasets: [\r\n      {\r\n        label: \"Отработанные часы\",\r\n        data: visDate,\r\n        backgroundColor: \"rgba(201, 119, 119, 0.8)\",\r\n      },\r\n    ],\r\n  };\r\n\r\n  return (\r\n    <div className={css.container}>\r\n      <div className={css.topInfo}>\r\n        <p>Кол-во отработанных часов</p>\r\n      </div>\r\n      <Bar options={options} data={data} />\r\n      <div className={css.month}>\r\n        <button onClick={() => monthSwitch(-1)} className={css.arrow}>\r\n          {\"<\"}\r\n        </button>\r\n        <p className={css.monthText}>\r\n          {ruMonthes[currentDate.getMonth()]} {currentDate.getFullYear()}\r\n        </p>\r\n        <button onClick={() => monthSwitch(1)} className={css.arrow}>\r\n          {\">\"}\r\n        </button>\r\n        <Results visDate={visDate}></Results>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default withAuth(Statistic);\r\n"]},"metadata":{},"sourceType":"module"}