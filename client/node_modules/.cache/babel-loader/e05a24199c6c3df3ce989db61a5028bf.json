{"ast":null,"code":"import _asyncToGenerator from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{withAuth}from\"../hoc/withAuth\";import css from\"./Settings.module.css\";import{useCallback,useState}from\"react\";import MessagePopup from\"./MessagePopup/MessagePopup\";import{useSelector}from\"react-redux\";import{useDispatch}from\"react-redux\";import{setMessage}from\"../../redux/settings/settingsActions\";import SendButton from\"./SendButton/SendButton\";import axios from\"axios\";import{domain}from\"../../config\";import FileUpload from\"../Custom/FileUpload/FileUpload\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Settings=function Settings(){var _useSelector=useSelector(function(state){return state.app;}),userId=_useSelector.userId;var _useSelector2=useSelector(function(state){return state.settings;}),settingsMessages=_useSelector2.settingsMessages;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),password=_useState2[0],setPassword=_useState2[1];var dispatch=useDispatch();var changeProfileImage=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios({method:\"post\",url:\"\".concat(domain,\"/user/upload_img\"),data:{userId:userId,pathImg:\"\".concat(file.uuid,\"/-/crop/\").concat(file.crop.width,\"x\").concat(file.crop.height,\"/\").concat(file.crop.left,\",\").concat(file.crop.top,\"/\")}});case 3:response=_context.sent;if(response.status===200){dispatch(setMessage(\"IMAGE_SET_SUCCESS\"));}_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.log(_context.t0);dispatch(setMessage(\"UNDEFIEND_IMAGE_ERROR\"));case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function(_x){return _ref.apply(this,arguments);};}(),[dispatch,userId]);var sendPassword=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!(password.length<6)){_context2.next=4;break;}dispatch(setMessage(\"PASSWORD_CHANGE_LENGTH\"));return _context2.abrupt(\"return\");case 4:_context2.next=6;return axios({method:\"put\",url:\"\".concat(domain,\"/user/change_password\"),data:{id:userId,password:password}});case 6:response=_context2.sent;if(response.status===200){dispatch(setMessage(\"PASSWORD_CHANGE_SUCCESS\"));}_context2.next=14;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);dispatch(setMessage(\"PASSWORD_CHANGE_ERROR\"));case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);})),[dispatch,password,userId]);return/*#__PURE__*/_jsxs(\"div\",{className:css.container,children:[settingsMessages&&/*#__PURE__*/_jsx(MessagePopup,{}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{className:css.item,children:[/*#__PURE__*/_jsx(\"p\",{className:css.itemName,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u0444\\u043E\\u0442\\u043E \\u043F\\u0440\\u043E\\u0444\\u0438\\u043B\\u044F\"}),/*#__PURE__*/_jsx(\"div\",{className:css.itemSetter,children:/*#__PURE__*/_jsx(FileUpload,{crop:\"1:1\",onChange:changeProfileImage})})]}),/*#__PURE__*/_jsxs(\"li\",{className:css.item,children:[/*#__PURE__*/_jsx(\"p\",{className:css.itemName,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\"}),/*#__PURE__*/_jsxs(\"div\",{className:css.itemSetter,children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(e){return setPassword(e.target.value);},className:css.textInput}),/*#__PURE__*/_jsx(SendButton,{onClick:function onClick(){return sendPassword();}})]})]})]})]});};export default withAuth(Settings);","map":{"version":3,"sources":["D:/Work/Projects/web_sheet_node_server/client/src/components/Settings/Settings.jsx"],"names":["withAuth","css","useCallback","useState","MessagePopup","useSelector","useDispatch","setMessage","SendButton","axios","domain","FileUpload","Settings","state","app","userId","settings","settingsMessages","password","setPassword","dispatch","changeProfileImage","file","method","url","data","pathImg","uuid","crop","width","height","left","top","response","status","console","log","sendPassword","length","id","container","item","itemName","itemSetter","e","target","value","textInput"],"mappings":"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","sourcesContent":["import { withAuth } from \"../hoc/withAuth\";\r\nimport css from \"./Settings.module.css\";\r\nimport { useCallback, useState } from \"react\";\r\nimport MessagePopup from \"./MessagePopup/MessagePopup\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { setMessage } from \"../../redux/settings/settingsActions\";\r\nimport SendButton from \"./SendButton/SendButton\";\r\nimport axios from \"axios\";\r\nimport { domain } from \"../../config\";\r\nimport FileUpload from \"../Custom/FileUpload/FileUpload\";\r\n\r\nconst Settings = () => {\r\n  const { userId } = useSelector((state) => state.app);\r\n  const { settingsMessages } = useSelector((state) => state.settings);\r\n  const [password, setPassword] = useState(\"\");\r\n  const dispatch = useDispatch();\r\n\r\n  const changeProfileImage = useCallback(\r\n    async (file) => {\r\n      try {\r\n        const response = await axios({\r\n          method: \"post\",\r\n          url: `${domain}/user/upload_img`,\r\n          data: {\r\n            userId,\r\n            pathImg: `${file.uuid}/-/crop/${file.crop.width}x${file.crop.height}/${file.crop.left},${file.crop.top}/`,\r\n          },\r\n        });\r\n        if (response.status === 200) {\r\n          dispatch(setMessage(\"IMAGE_SET_SUCCESS\"));\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n        dispatch(setMessage(\"UNDEFIEND_IMAGE_ERROR\"));\r\n      }\r\n    },\r\n    [dispatch, userId]\r\n  );\r\n\r\n  const sendPassword = useCallback(async () => {\r\n    try {\r\n      if (password.length < 6) {\r\n        dispatch(setMessage(\"PASSWORD_CHANGE_LENGTH\"));\r\n        return;\r\n      }\r\n      const response = await axios({\r\n        method: \"put\",\r\n        url: `${domain}/user/change_password`,\r\n        data: { id: userId, password },\r\n      });\r\n      if (response.status === 200) {\r\n        dispatch(setMessage(\"PASSWORD_CHANGE_SUCCESS\"));\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n      dispatch(setMessage(\"PASSWORD_CHANGE_ERROR\"));\r\n    }\r\n  }, [dispatch, password, userId]);\r\n\r\n  return (\r\n    <div className={css.container}>\r\n      {settingsMessages && <MessagePopup />}\r\n      <ul>\r\n        <li className={css.item}>\r\n          <p className={css.itemName}>Изменить фото профиля</p>\r\n          <div className={css.itemSetter}>\r\n            <FileUpload crop=\"1:1\" onChange={changeProfileImage} />\r\n          </div>\r\n        </li>\r\n\r\n        <li className={css.item}>\r\n          <p className={css.itemName}>Изменить пароль</p>\r\n          <div className={css.itemSetter}>\r\n            <input\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              className={css.textInput}\r\n            />\r\n            <SendButton onClick={() => sendPassword()} />\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\nexport default withAuth(Settings);\r\n"]},"metadata":{},"sourceType":"module"}