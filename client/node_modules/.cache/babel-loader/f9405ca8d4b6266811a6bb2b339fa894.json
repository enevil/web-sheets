{"ast":null,"code":"import _objectSpread from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _asyncToGenerator from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"D:\\\\Work\\\\Projects\\\\web_sheet_node_server\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{FormProvider,useForm}from\"react-hook-form\";import{useCallback,useState}from\"react\";import css from\"./AddRecipeForm.module.css\";import FormBody from\"./FormBody/FormBody\";import GoBack from\"../../Custom/GoBack/GoBack\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import FormHeader from\"./FormHeader/FormHeader\";import{useSelector}from\"react-redux\";import{useEffect}from\"react\";import{domain}from\"../../../config\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AddRecipeForm=function AddRecipeForm(_ref){var defaultProps=_ref.defaultProps;var _useSelector=useSelector(function(state){return state.app;}),userId=_useSelector.userId;var formMethods=useForm({defaultValues:defaultProps||{products:[{ingredient:\"\",weightOf:\"\"}]}});var handleSubmit=formMethods.handleSubmit,reset=formMethods.reset;var _useState=useState(),_useState2=_slicedToArray(_useState,2),img=_useState2[0],setImg=_useState2[1];var navigate=useNavigate();var goBack=function goBack(){navigate(-1);};// refresh defaultValues\nuseEffect(function(){reset(defaultProps);},[defaultProps,reset]);var onFileUpload=useCallback(function(file){setImg(\"\".concat(file.uuid,\"/-/crop/\").concat(file.crop.width,\"x\").concat(file.crop.height,\"/\").concat(file.crop.left,\",\").concat(file.crop.top,\"/\"));},[]);var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData){var description,name,type,products,prepFormData,endpoint,method,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;description=formData.description,name=formData.name,type=formData.type,products=formData.products;prepFormData={description:description,name:name,author:userId,type:type,products:products,pathImg:img||(defaultProps===null||defaultProps===void 0?void 0:defaultProps.pathImg),id:defaultProps===null||defaultProps===void 0?void 0:defaultProps._id};endpoint=defaultProps?\"edit\":\"add\";method=defaultProps?\"put\":\"post\";_context.next=7;return axios({method:method,url:\"\".concat(domain,\"/recipe/\").concat(endpoint),data:prepFormData});case 7:response=_context.sent;console.log(response);if(response.data.success)goBack();_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"defaultContainer\",children:[/*#__PURE__*/_jsx(GoBack,{}),/*#__PURE__*/_jsx(FormProvider,_objectSpread(_objectSpread({},formMethods),{},{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsx(FormHeader,{img:img,onFileUpload:onFileUpload,oldPreview:defaultProps===null||defaultProps===void 0?void 0:defaultProps.pathImg}),/*#__PURE__*/_jsx(FormBody,{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:css.submit,children:\"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u044C\"})]})}))]});};export default AddRecipeForm;","map":{"version":3,"sources":["D:/Work/Projects/web_sheet_node_server/client/src/components/Recipes/AddRecipeForm/AddRecipeForm.jsx"],"names":["FormProvider","useForm","useCallback","useState","css","FormBody","GoBack","axios","useNavigate","FormHeader","useSelector","useEffect","domain","AddRecipeForm","defaultProps","state","app","userId","formMethods","defaultValues","products","ingredient","weightOf","handleSubmit","reset","img","setImg","navigate","goBack","onFileUpload","file","uuid","crop","width","height","left","top","onSubmit","formData","description","name","type","prepFormData","author","pathImg","id","_id","endpoint","method","url","data","response","console","log","success","submit"],"mappings":"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","sourcesContent":["import { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useCallback, useState } from \"react\";\r\n\r\nimport css from \"./AddRecipeForm.module.css\";\r\nimport FormBody from \"./FormBody/FormBody\";\r\nimport GoBack from \"../../Custom/GoBack/GoBack\";\r\nimport axios from \"axios\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport FormHeader from \"./FormHeader/FormHeader\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useEffect } from \"react\";\r\nimport { domain } from \"../../../config\";\r\n\r\nconst AddRecipeForm = ({ defaultProps }) => {\r\n  const { userId } = useSelector((state) => state.app);\r\n  const formMethods = useForm({\r\n    defaultValues: defaultProps || {\r\n      products: [{ ingredient: \"\", weightOf: \"\" }],\r\n    },\r\n  });\r\n  const { handleSubmit, reset } = formMethods;\r\n  const [img, setImg] = useState();\r\n  const navigate = useNavigate();\r\n  const goBack = () => {\r\n    navigate(-1);\r\n  };\r\n\r\n  // refresh defaultValues\r\n  useEffect(() => {\r\n    reset(defaultProps);\r\n  }, [defaultProps, reset]);\r\n\r\n  const onFileUpload = useCallback((file) => {\r\n    setImg(\r\n      `${file.uuid}/-/crop/${file.crop.width}x${file.crop.height}/${file.crop.left},${file.crop.top}/`\r\n    );\r\n  }, []);\r\n\r\n  const onSubmit = async (formData) => {\r\n    try {\r\n      const { description, name, type, products } = formData;\r\n      const prepFormData = {\r\n        description,\r\n        name,\r\n        author: userId,\r\n        type,\r\n        products,\r\n        pathImg: img || defaultProps?.pathImg,\r\n        id: defaultProps?._id,\r\n      };\r\n      const endpoint = defaultProps ? \"edit\" : \"add\";\r\n      const method = defaultProps ? \"put\" : \"post\";\r\n      const response = await axios({\r\n        method,\r\n        url: `${domain}/recipe/${endpoint}`,\r\n        data: prepFormData,\r\n      });\r\n      console.log(response);\r\n      if (response.data.success) goBack();\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"defaultContainer\">\r\n      <GoBack />\r\n      <FormProvider {...formMethods}>\r\n        <form onSubmit={handleSubmit(onSubmit)}>\r\n          <FormHeader\r\n            img={img}\r\n            onFileUpload={onFileUpload}\r\n            oldPreview={defaultProps?.pathImg}\r\n          />\r\n          <FormBody />\r\n          <button type=\"submit\" className={css.submit}>\r\n            Подтвердить\r\n          </button>\r\n        </form>\r\n      </FormProvider>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddRecipeForm;\r\n"]},"metadata":{},"sourceType":"module"}